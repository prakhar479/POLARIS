# POLARIS Plugin Configuration for Switch System
# =====================================
# Configuration for the Switch ML-enabled adaptive system exemplar
# with YOLO model switching capabilities for object detection

# =============================================================================
# System Identification and Metadata
# =============================================================================
system_name: "switch_yolo"
system_version: "1.0.0"

# =============================================================================
# Implementation Configuration
# =============================================================================
implementation:
  # Connector class for Switch system (uses SwitchSystemConnector)
  connector_class: "connector.SwitchSystemConnector"
  
  # Connection timeout in seconds
  timeout: 30.0
  
  # Maximum retry attempts for failed operations
  max_retries: 3
  
  # Retry configuration
  retry_base_delay: 1.0
  retry_max_delay: 5.0

# =============================================================================
# Connection Configuration
# =============================================================================
connection:
  protocol: "http"
  host: "localhost"
  port: 3001
  
  auth:
    type: "none"
  
  ssl:
    enabled: false
    verify_certificates: false

# =============================================================================
# Switch System Specific Configuration
# =============================================================================
# File paths for Switch system control files (relative to plugin directory)
switch_system:
  # Path to model.csv (current active model)
  model_file_path: "../switch/NAVIE/model.csv"
  
  # Path to monitor.csv (current input rate)
  monitor_file_path: "../switch/NAVIE/monitor.csv"
  
  # Path to knowledge.csv (adaptation thresholds)
  knowledge_file_path: "../switch/NAVIE/knowledge.csv"
  
  # Path to metrics.csv (collected metrics)
  metrics_file_path: "../switch/NAVIE/metrics.csv"

# =============================================================================
# Monitoring Configuration
# =============================================================================
monitoring:
  enabled: true
  
  # Monitoring interval (seconds) - collect metrics every 5 seconds
  interval: 5.0
  
  # Metrics to collect from Switch system
  metrics:
    # Primary performance metric - model processing time
    - name: "switch_yolo.image_processing_time"
      command: "get_latest_metrics"
      params:
        metric_name: "image_processing_time"
      unit: "seconds"
      type: "float"
      description: "Time taken by YOLO model to process one image"
      category: "performance"
    
    # Quality metric - detection confidence
    - name: "switch_yolo.confidence"
      command: "get_latest_metrics"
      params:
        metric_name: "confidence"
      unit: "score"
      type: "float"
      description: "Average confidence score of object detections"
      category: "quality"
    
    # Composite utility metric
    - name: "switch_yolo.utility"
      command: "get_latest_metrics"
      params:
        metric_name: "utility"
      unit: "score"
      type: "float"
      description: "Utility function combining response time and confidence"
      category: "quality"
    
    # Resource utilization
    - name: "switch_yolo.cpu_usage"
      command: "get_latest_metrics"
      params:
        metric_name: "cpu"
      unit: "percent"
      type: "float"
      description: "CPU utilization percentage"
      category: "resource"
    
    # Detection results
    - name: "switch_yolo.detection_boxes"
      command: "get_latest_metrics"
      params:
        metric_name: "detection_boxes"
      unit: "count"
      type: "integer"
      description: "Number of objects detected in the image"
      category: "quality"
    
    # Throughput metric
    - name: "switch_yolo.total_processed"
      command: "get_latest_metrics"
      params:
        metric_name: "log_id"
      unit: "count"
      type: "integer"
      description: "Total number of images processed"
      category: "performance"
    
    # Current active model
    - name: "switch_yolo.current_model"
      command: "get_current_model"
      unit: "string"
      type: "string"
      description: "Currently active YOLO model name"
      category: "configuration"
  
  # Derived metrics calculated from base metrics
  derived_metrics:
    # Performance index combining multiple factors
    - name: "performance_index"
      formula: "(utility * 100) / (image_processing_time + 0.1)"
      unit: "index"
      description: "Composite performance index (higher is better)"
    
    # Throughput rate
    - name: "processing_rate"
      formula: "1.0 / (image_processing_time + 0.001)"
      unit: "images_per_second"
      description: "Estimated image processing rate"
  
  # Monitoring strategies
  strategies:
    # Collect all metrics in a single batch operation
    batch_collection: true
    
    # Sequential collection (metrics share the same data source)
    parallel_collection: false
    
    # Maximum concurrent operations
    max_concurrent: 1
    
    # Skip failed metrics and continue
    error_handling: "skip"

# =============================================================================
# Execution Configuration
# =============================================================================
execution:
  enabled: true
  
  # Available actions for adaptation
  actions:
    # Switch to YOLOv5n (nano - fastest, lowest accuracy)
    - type: "SWITCH_MODEL_YOLOV5N"
      command: "switch_model"
      description: "Switch to YOLOv5n model (fastest, lowest accuracy)"
      parameters:
        - name: "model"
          type: "string"
          required: true
          default: "yolov5n"
      impact:
        severity: "medium"
        reversible: true
        estimated_duration: 2.0
    
    # Switch to YOLOv5s (small)
    - type: "SWITCH_MODEL_YOLOV5S"
      command: "switch_model"
      description: "Switch to YOLOv5s model (balanced)"
      parameters:
        - name: "model"
          type: "string"
          required: true
          default: "yolov5s"
      impact:
        severity: "medium"
        reversible: true
        estimated_duration: 2.0
    
    # Switch to YOLOv5m (medium)
    - type: "SWITCH_MODEL_YOLOV5M"
      command: "switch_model"
      description: "Switch to YOLOv5m model (medium accuracy)"
      parameters:
        - name: "model"
          type: "string"
          required: true
          default: "yolov5m"
      impact:
        severity: "medium"
        reversible: true
        estimated_duration: 2.0
    
    # Switch to YOLOv5l (large)
    - type: "SWITCH_MODEL_YOLOV5L"
      command: "switch_model"
      description: "Switch to YOLOv5l model (high accuracy)"
      parameters:
        - name: "model"
          type: "string"
          required: true
          default: "yolov5l"
      impact:
        severity: "medium"
        reversible: true
        estimated_duration: 2.0
    
    # Switch to YOLOv5x (extra large)
    - type: "SWITCH_MODEL_YOLOV5X"
      command: "switch_model"
      description: "Switch to YOLOv5x model (highest accuracy, slowest)"
      parameters:
        - name: "model"
          type: "string"
          required: true
          default: "yolov5x"
      impact:
        severity: "medium"
        reversible: true
        estimated_duration: 2.0
    
    # Generic model switch action with parameter
    - type: "SWITCH_MODEL"
      command: "switch_model"
      description: "Switch to specified YOLO model"
      parameters:
        - name: "model"
          type: "string"
          required: true
          validation:
            enum: ["yolov5n", "yolov5s", "yolov5m", "yolov5l", "yolov5x"]
      preconditions:
        - check: "cpu_usage < 95"
          message: "CPU usage too high to safely switch models"
      impact:
        severity: "medium"
        reversible: true
        estimated_duration: 2.0
    
    # Update knowledge base (adaptation thresholds)
    - type: "UPDATE_KNOWLEDGE"
      command: "update_knowledge"
      description: "Update adaptation thresholds for model switching"
      parameters:
        - name: "yolov5nLower"
          type: "float"
          required: true
          validation:
            min: 0.0
            max: 100.0
        - name: "yolov5nUpper"
          type: "float"
          required: true
          validation:
            min: 0.0
            max: 100.0
        - name: "yolov5sLower"
          type: "float"
          required: true
          validation:
            min: 0.0
            max: 100.0
        - name: "yolov5sUpper"
          type: "float"
          required: true
          validation:
            min: 0.0
            max: 100.0
        - name: "yolov5mLower"
          type: "float"
          required: true
          validation:
            min: 0.0
            max: 100.0
        - name: "yolov5mUpper"
          type: "float"
          required: true
          validation:
            min: 0.0
            max: 100.0
        - name: "yolov5lLower"
          type: "float"
          required: true
          validation:
            min: 0.0
            max: 100.0
        - name: "yolov5lUpper"
          type: "float"
          required: true
          validation:
            min: 0.0
            max: 100.0
        - name: "yolov5xLower"
          type: "float"
          required: true
          validation:
            min: 0.0
            max: 100.0
        - name: "yolov5xUpper"
          type: "float"
          required: true
          validation:
            min: 0.0
            max: 100.0
      impact:
        severity: "low"
        reversible: true
        estimated_duration: 1.0
    
    # Processing control actions
    - type: "START_PROCESSING"
      command: "start_processing"
      description: "Start the image processing pipeline"
      impact:
        severity: "high"
        reversible: true
        estimated_duration: 5.0
    
    - type: "STOP_PROCESSING"
      command: "stop_processing"
      description: "Stop the image processing pipeline"
      impact:
        severity: "high"
        reversible: true
        estimated_duration: 3.0
    
    - type: "RESTART_PROCESSING"
      command: "restart_processing"
      description: "Restart the image processing pipeline"
      impact:
        severity: "high"
        reversible: true
        estimated_duration: 8.0
  
  # Execution constraints
  constraints:
    # Minimum interval between model switches (seconds)
    min_interval: 2.0
    
    # Maximum concurrent actions (serialize for safety)
    max_concurrent: 1
    
    # Maximum queue size
    queue_size: 100

# =============================================================================
# Verification Configuration - SWITCH Optimized
# =============================================================================
verification:
  input_subject: "polaris.verification.requests"
  output_subject: "polaris.verification.results"
  policy_subject: "polaris.verification.policies"
  metrics_subject: "polaris.verification.metrics"

  # Faster verification for SWITCH's model switching requirements
  default_timeout_sec: 15
  max_concurrent_verifications: 8
  enable_by_default: true

  routing:
    enable_automatic_routing: true
    bypass_action_types: []
    require_verification_for: ["SWITCH_MODEL"]  # Only critical model switching actions

  # SWITCH-Optimized Thresholds
  thresholds:
    # SWITCH system performance thresholds
    max_response_time_s: 1.0          # Maximum acceptable response time
    min_confidence: 0.5               # Minimum detection confidence
    max_cpu_utilization: 0.95         # Maximum CPU before forced action
    target_utility: 0.8               # Target utility score

    # SWITCH system safety constraints
    min_system_availability: 0.99     # SWITCH system is critical for evaluation
    max_error_rate_increase: 0.05     # Higher tolerance for SWITCH scenarios

    # SWITCH system resource allocation - optimized for model switching
    max_concurrent_actions: 3         # SWITCH can handle few concurrent actions
    max_action_duration_minutes: 20   # SWITCH actions are fast

    # SWITCH system change management - appropriate for research system
    max_configuration_changes_per_hour: 10
    require_approval_for_changes_affecting_users: true

  # SWITCH Safety Constraints
  constraints:
    # Model switching safety constraints
    - id: "model_switch_safety"
      type: "model_switching"
      severity: "critical"
      description: "Ensure model switching doesn't cause system instability"
      condition: "model_switch_interval >= 2.0 and model_switches_per_hour <= 30"
      violation_message: "Model switching would violate stability constraints"
      suggested_fix: "Increase switch interval or reduce switching frequency"

    # Response time constraints
    - id: "response_time_safety"
      type: "performance"
      severity: "high"
      description: "Prevent actions that would cause excessive response time"
      condition: "predicted_response_time <= 1.0"  # Max 1 second
      violation_message: "Action would cause response time > 1.0s"
      suggested_fix: "Consider lighter YOLO model or reduce load"

    # Confidence constraints
    - id: "confidence_safety"
      type: "quality"
      severity: "medium"
      description: "Ensure minimum detection confidence is maintained"
      condition: "predicted_confidence >= 0.5"  # Min 50% confidence
      violation_message: "Action would reduce confidence below 50%"
      suggested_fix: "Consider heavier YOLO model for better accuracy"

    # CPU utilization constraints
    - id: "cpu_utilization_safety"
      type: "resource"
      severity: "high"
      description: "Prevent actions that would cause excessive CPU utilization"
      condition: "predicted_cpu_utilization <= 0.95"  # Max 95% CPU
      violation_message: "Action would exceed CPU utilization limit (95%)"
      suggested_fix: "Consider lighter YOLO model or reduce processing load"

    # Utility function constraints
    - id: "utility_safety"
      type: "optimization"
      severity: "medium"
      description: "Ensure actions maintain acceptable utility levels"
      condition: "predicted_utility >= 0.4"  # Min acceptable utility
      violation_message: "Action would reduce utility below 0.4"
      suggested_fix: "Choose model that balances speed and accuracy better"

  # SWITCH Verification Policies
  policies:
    # Model switching policy
    - id: "model_switching"
      enabled: true
      verification_level: "strict"
      timeout_sec: 10.0
      required_checks:
        - "model_switch_safety"
        - "response_time_safety"
        - "cpu_utilization_safety"
        - "utility_safety"
      optional_checks:
        - "confidence_safety"

    # Utility optimization policy
    - id: "utility_optimization"
      enabled: true
      verification_level: "moderate"
      timeout_sec: 15.0
      required_checks:
        - "utility_safety"
        - "response_time_safety"
      optional_checks:
        - "cpu_utilization_safety"
        - "confidence_safety"

  # SWITCH-Optimized Risk Levels
  risk_levels:
    low:
      verification_level: "basic"
      auto_approve: true
      require_human_approval: false

    medium:
      verification_level: "policy"
      auto_approve: true  # Auto-approve for SWITCH system research
      require_human_approval: true
      additional_checks: ["resource_impact"]

    high:
      verification_level: "policy"  # Reduced from comprehensive
      auto_approve: false
      require_human_approval: true  # Even critical actions need human approval in SWITCH system
      require_multiple_approvals: true
      additional_checks: ["resource_impact", "simulation"]

    critical:
      verification_level: "comprehensive"
      auto_approve: false
      require_human_approval: true  # Even critical actions need human approval in SWITCH system
      require_multiple_approvals: true
      additional_checks: ["simulation", "rollback_plan"]

# =============================================================================
# Plugin Metadata
# =============================================================================
metadata:
  author: "POLARIS Integration Team"
  description: "Plugin for Switch ML-enabled adaptive system with YOLO model switching"
  documentation: "https://github.com/prakhar479/POLARIS"
  tags:
    - "ml-system"
    - "object-detection"
    - "yolo"
    - "adaptive-system"
    - "model-switching"
