{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "POLARIS Framework Configuration Schema",
  "description": "Schema for validating POLARIS framework configuration (polaris_config.yaml)",
  "type": "object",
  "required": ["nats", "telemetry", "execution", "logger"],
  "properties": {
    "nats": {
      "type": "object",
      "description": "NATS server configuration",
      "required": ["url"],
      "properties": {
        "url": {
          "type": "string",
          "description": "NATS server URL",
          "pattern": "^nats://.*",
          "default": "nats://localhost:4222"
        }
      }
    },
    "telemetry": {
      "type": "object",
      "description": "Telemetry configuration for Monitor adapters",
      "required": ["stream_subject", "batch_subject"],
      "properties": {
        "stream_subject": {
          "type": "string",
          "description": "Subject for streaming individual telemetry events",
          "default": "polaris.telemetry.events.stream"
        },
        "batch_subject": {
          "type": "string",
          "description": "Subject for batched telemetry events",
          "default": "polaris.telemetry.events.batch"
        },
        "batch_size": {
          "type": "integer",
          "description": "Maximum number of events per batch",
          "minimum": 1,
          "default": 100
        },
        "batch_max_wait": {
          "type": "number",
          "description": "Maximum wait time before sending incomplete batch (seconds)",
          "minimum": 0.1,
          "default": 1.0
        },
        "queue_maxsize": {
          "type": "integer",
          "description": "Max queue size for in-memory buffering (0 = unbounded)",
          "minimum": 0,
          "default": 5000
        },
        "stream": {
          "type": "boolean",
          "description": "If true, publish individual events immediately in addition to batching",
          "default": true
        }
      }
    },
    "execution": {
      "type": "object",
      "description": "Execution configuration for Execution adapters",
      "required": ["action_subject", "result_subject", "metrics_subject"],
      "properties": {
        "action_subject": {
          "type": "string",
          "description": "NATS subject where control actions are expected",
          "default": "polaris.execution.actions"
        },
        "result_subject": {
          "type": "string",
          "description": "Subject where execution results are published",
          "default": "polaris.execution.results"
        },
        "metrics_subject": {
          "type": "string",
          "description": "Subject used to publish execution-related metrics",
          "default": "polaris.execution.metrics"
        }
      }
    },
    "logger": {
      "type": "object",
      "description": "Logging configuration",
      "required": ["name", "level", "format"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Logger name used by the framework",
          "default": "polaris"
        },
        "level": {
          "type": "string",
          "description": "Logging level",
          "enum": ["DEBUG", "INFO", "WARNING", "ERROR"],
          "default": "INFO"
        },
        "format": {
          "type": "string",
          "description": "Log format",
          "enum": ["pretty", "json"],
          "default": "pretty"
        }
      }
    },
    "digital_twin": {
      "type": "object",
      "description": "Digital Twin component configuration",
      "required": ["nats", "grpc", "world_model"],
      "properties": {
        "nats": {
          "type": "object",
          "description": "NATS configuration for Digital Twin",
          "required": ["update_subject", "calibrate_subject", "error_subject", "queue_group"],
          "properties": {
            "update_subject": {
              "type": "string",
              "description": "Subject for publishing update commands to Digital Twin",
              "default": "polaris.digitaltwin.update"
            },
            "calibrate_subject": {
              "type": "string",
              "description": "Subject for model calibration feedback",
              "default": "polaris.digitaltwin.calibrate"
            },
            "error_subject": {
              "type": "string",
              "description": "Subject for Digital Twin error messages",
              "default": "polaris.digitaltwin.errors"
            },
            "queue_group": {
              "type": "string",
              "description": "NATS queue group for Digital Twin workers",
              "default": "digital_twin_workers"
            },
            "max_reconnect_attempts": {
              "type": "integer",
              "description": "Maximum NATS reconnection attempts",
              "minimum": 1,
              "default": 10
            },
            "reconnect_wait_sec": {
              "type": "number",
              "description": "Wait time between reconnection attempts (seconds)",
              "minimum": 0.1,
              "default": 2
            },
            "queue_maxsize": {
              "type": "integer",
              "description": "Maximum message queue size",
              "minimum": 1,
              "default": 1000
            },
            "batch_size": {
              "type": "integer",
              "description": "Message batch size for processing",
              "minimum": 1,
              "default": 10
            },
            "batch_timeout_sec": {
              "type": "number",
              "description": "Batch timeout for message processing (seconds)",
              "minimum": 0.1,
              "default": 1.0
            }
          }
        },
        "grpc": {
          "type": "object",
          "description": "gRPC server configuration for Digital Twin",
          "required": ["host", "port"],
          "properties": {
            "host": {
              "type": "string",
              "description": "gRPC server host address",
              "default": "0.0.0.0"
            },
            "port": {
              "type": "integer",
              "description": "gRPC server port",
              "minimum": 1,
              "maximum": 65535,
              "default": 50051
            },
            "max_workers": {
              "type": "integer",
              "description": "Maximum number of gRPC worker threads",
              "minimum": 1,
              "default": 10
            },
            "max_message_size": {
              "type": "integer",
              "description": "Maximum gRPC message size in bytes",
              "minimum": 1024,
              "default": 4194304
            },
            "keepalive_time_ms": {
              "type": "integer",
              "description": "gRPC keepalive time in milliseconds",
              "minimum": 1000,
              "default": 30000
            },
            "keepalive_timeout_ms": {
              "type": "integer",
              "description": "gRPC keepalive timeout in milliseconds",
              "minimum": 1000,
              "default": 5000
            }
          }
        },
        "world_model": {
          "type": "object",
          "description": "World Model configuration",
          "required": ["implementation"],
          "properties": {
            "implementation": {
              "type": "string",
              "description": "World Model implementation type",
              "enum": ["mock", "gemini", "statistical", "hybrid", "bayesian"],
              "default": "mock"
            },
            "config_path": {
              "type": "string",
              "description": "Path to World Model specific configuration file",
              "default": "config/world_model.yaml"
            },
            "reload_on_failure": {
              "type": "boolean",
              "description": "Whether to reload model on failure",
              "default": true
            },
            "health_check_interval_sec": {
              "type": "number",
              "description": "Health check interval in seconds",
              "minimum": 1,
              "default": 60
            }
          }
        },
        "performance": {
          "type": "object",
          "description": "Performance settings for Digital Twin",
          "properties": {
            "max_concurrent_queries": {
              "type": "integer",
              "description": "Maximum concurrent query processing",
              "minimum": 1,
              "default": 10
            },
            "query_timeout_sec": {
              "type": "number",
              "description": "Query timeout in seconds",
              "minimum": 1,
              "default": 30
            },
            "simulation_timeout_sec": {
              "type": "number",
              "description": "Simulation timeout in seconds",
              "minimum": 1,
              "default": 60
            }
          }
        },
        "debugging": {
          "type": "object",
          "description": "Debugging and logging configuration for Digital Twin",
          "properties": {
            "log_level": {
              "type": "string",
              "description": "Digital Twin specific log level",
              "enum": ["DEBUG", "INFO", "WARNING", "ERROR"],
              "default": "INFO"
            },
            "enable_detailed_logging": {
              "type": "boolean",
              "description": "Enable detailed logging for debugging",
              "default": false
            },
            "log_to_console": {
              "type": "boolean",
              "description": "Log to console in addition to file",
              "default": true
            },
            "log_file": {
              "type": "string",
              "description": "Path to Digital Twin log file",
              "default": "logs/digital_twin.log"
            }
          }
        }
      }
    }
  }
}